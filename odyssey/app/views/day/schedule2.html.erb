<%= render 'layouts/navbar' %>

<script>
  $(document).ready(function() {
    $('#calendar').fullCalendar({
        weekends: false,
        defaultView: 'month',
        dayClick: function(date, jsEvent, view){
            //displayConfirm(date, jsEvent, view);
            
            $('#calendar').fullCalendar( 'refetchEvents' );
            $('#calendar').fullCalendar( 'renderEvent', {id:'0000TEMP0000', title:'newDay', start: date, rendering:'background', allDay:true, color:'blue'});
        },
        header: {
          left:   'title',
          center: '',
          right:  'today prev,next'
        }
    })
    
    GetAllDays();
  });
  
    function AddDay(d) {
        $.ajax({
            type: "POST",
            dataType: "json",
            url: "/days/create",
            data: { date: d },
            success: function(data) {
                GetAllDays();
                    $('#confirmModal').modal('hide');
                },
            error: function(data) {
                $('#confirmModal').modal('hide');
                displayError(data.responseText);
            }
        });
    }

    function GetAllDays() {
        var events = [];
        $.ajax({
            type: "GET",
            dataType: "json",
            url: "/days/all",
            success: function(data) {
                $.each(data, function(key, value){
                    events.push({title:key, start:value.date, rendering:'background', allDay:true, color:'green'});
                })
                $('#calendar').fullCalendar( 'removeEvents' )
                $('#calendar').fullCalendar( 'addEventSource', events );
                $('#calendar').fullCalendar( 'refetchEvents' );
            },
            error: function(data) {
                $('#confirmModal').modal('hide');
                displayError(data.responseText);
            }
        });
    }
    
    function displayConfirm(date, jsEvent, view) {
        var modal = "<div class=\"modal fade\" id=\"confirmModal\" role=\"dialog\">" +
                        "<div class=\"modal-dialog modal-sm\">" +
                          "<div class=\"modal-content\">" +
                            "<div class=\"modal-header\">" +
                                "<h4 class=\"modal-title\">Confirmation</h4>" +
                            "</div>" +
                            "<div class=\"modal-body\">" +
                                "<p>Make <strong>" + date.format('dddd, MMMM Do') + "</strong> avaliable to schedule pickups?</p>" +
                            "</div>" +
                            "<div class=\"modal-footer\">" +
                                "<button id=\"okButton\" type=\"button\" class=\"btn btn-success\" onclick=\"AddDay('"+date.format('Y-MM-DD')+"')\">Yes</button>" +
                                "<button type=\"button\" class=\"btn btn-danger\" data-dismiss=\"modal\">No</button>" +
                            "</div>" +
                          "</div>" +
                        "</div>" +
                      "</div>";
        $( ".container" ).append( modal );
        $('#confirmModal').modal({
            backdrop: 'static',
            keyboard: false
        }).show().on('hidden.bs.modal', function (e) {
          $(this).remove();
        });
    }
    
    function displayError(error){
        var modal = "<div class=\"modal fade\" id=\"errorModal\" role=\"dialog\">" +
                            "<div class=\"modal-dialog modal-sm\">" +
                              "<div class=\"modal-content\">" +
                                "<div class=\"modal-header\">" +
                                    "<h4 class=\"modal-title\">Error</h4>" +
                                "</div>" +
                                "<div class=\"modal-body\">" +
                                    "<p>"+error+"</p>" +
                                "</div>" +
                                "<div class=\"modal-footer\">" +
                                    "<button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">OK</button>" +
                                "</div>" +
                              "</div>" +
                            "</div>" +
                          "</div>";
            $( ".container" ).append( modal );
            $('#errorModal').modal({
                backdrop: 'static',
                keyboard: false
            }).show().on('hidden.bs.modal', function (e) {
              $(this).remove();
            });
    }
</script>

<div class="container white-container">
    <div class="row">
        <div class="col-xs-4 col-xs-offset-1">
            <h5 class="text-center">Select a day to add it to the schedule.</h5>
            <div id='calendar' style='width:100%; height:100%; padding-bottom:10%;'></div>
        </div>
        <div class="col-xs-6 col-xs-offset-1">
            <br />
            <br />
            <p>To add a day, either select a day on the calendar or manually input the day below: </p>
            <div class="row">
                <div class="col-xs-9 col-xs-offset-1">
                    <form>
                        <div class="form-group">
                            Month:
                            <select class="extra-right-margin form-control">
                                <option value="January">January</option>
                                <option value="February">February</option>
                                <option value="March">March</option>
                                <option value="April">April</option>
                                <option value="May">May</option>
                                <option value="June">June</option>
                                <option value="July">July</option>
                                <option value="August">August</option>
                                <option value="September">September</option>
                                <option value="October">October</option>
                                <option value="November">November</option>
                                <option value="December">December</option>
                            </select>
                        </div>
                        <div class="form-group">
                            Year:
                            <select class="form-control">
                                <% (@NUM_YEARS_TO_DISPLAY).times do |y| %>
                                    <option value="<%= (@START_YEAR + y) %>"><%= (@START_YEAR + y) %></option>
                                <% end %>
                            </select>
                        </div>
                        <br>
                        <div class="form-group">
                            <a href="/schedule/schedule1">
                                <btn class="btn btn-success btn-wide extra-right-margin">Submit</btn>
                            </a>
                            <a href="/schedule/schedule1">
                                <btn class="btn btn-danger btn-wide">Cancel</btn>
                            </a>
                        </div>
                    </form>

                </div>
            </div>
        </div>

    </div>
</div>